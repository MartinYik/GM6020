# Gimbal

## 基本信息

### 舵步主车云台：

-   can1电机： 
    -   左摩擦轮-3508，c620电调，id3 0x203 
    -   右摩擦轮-3508，c620电调，id2 0x202 
    -   拨盘电机-2006，c610电调，id1 0x201 
    -   pitch电机-6020，id2 0x206
-   can2电机： 
    -   yaw电机-6020，id5 0x209
-   pitch轴编码器范围： 1213（往下）-58（往上） 水平660  角度：最下53 最上3 水平28
-   摩擦轮无减速箱

## 要求

1.  通过遥控器控制云台，必须有遥控保护，先做，先验收，验收通过才能做后面的

优化一下之前遥控保护的判断，尝试使用信号量，并在遥控保护中设置积分误差清零，防止上电疯车

2.   pitch30°阶跃响应300ms、yaw30°阶跃响应时间350ms内，稳态误差不超过0.2°，超调量不超过0.2°

上位机控制，打印曲线，使用USART5，~~封装vofa上位机的模块，在vofa中调节各个参数~~

在PitchYaw的转速反馈中应使用陀螺仪所返回的角速度换算为转速（原始数据 / 16.4.f * 60.f / 360.f）进行PID计算，电机所反馈的转速声过大，即使经过滤波之后效果仍不理想

3.   控制摩擦轮开启和关闭，开启转速6k rpm

使用遥控器S1（右上角开关）往上(0)开启，其他(>0)关闭

4.   控制拨盘，实现单发和连发,要求连发射频20HZ

使用遥控器S2（左上角开关）往上(0)单发，往下(6)连发

5.   所有功能在一套代码上实现，不能一个功能一份代码

6.   所有功能能够用遥控器展示，遥控器控制逻辑自行设计

右摇杆水平(Rx)控制yaw轴，竖直(Ry)控制pitch轴，~~加入零漂死区控制~~，设置成角度增量变化，摇杆各通道做归一化处理

7.   尝试加入前馈进行控制

在Pitch角度环中使用，在响应遥控器的角度控制中加入

## 代码架构设计

### 应用层

#### 初始化任务

1.  外设初始化
2.  设备初始化

#### 设备任务

1.  云台状态
2.  遥控检测
3.  IMU数据获取
4.  Shoot
5.  PitchYaw
6.  电机控制
7.  串口发送
8.  ~~点灯任务~~

#### 数据池

-   用于存放常用头文件和定义实例化各个设备对象

### 设备层

1.  遥控器
2.  电机
    1.  3508
    2.  2006
    3.  6020
3.  MPU6050
4.  板载LED

### 算法层

1.  PID
2.  ~~滤波算法（已弃用）~~

### 驱动层

1.  can
2.  uart
3.  软件iic